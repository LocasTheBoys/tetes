print("Test 2")
-- Baris 1 diubah untuk langsung mengambil fungsi getupvalue dari debug
local getupvalue = debug.getupvalue

local users = {
    "strob5ck"
}

local troopsToSend = {
    "CamoToilet",
    "MafiaToilet"
}

local TTD
local save
local handler
local Network
local Invoke
local Fire

task.spawn(function()
    TTD = require(game:GetService("ReplicatedStorage").MultiboxFramework)
    save = TTD.Replicate:WaitForReplica("PlayerData-" .. game:GetService("Players").LocalPlayer.UserId)

    repeat
        pcall(function()
            Network = TTD.Network
            Invoke = Network.Invoke
            Fire = Network.Fire
        end)
        task.wait(0.1)
    until Network ~= nil and Invoke ~= nil and Fire ~= nil

    -- Tambahkan pengecekan apakah Invoke dan Fire adalah fungsi
    if type(Invoke) == "function" and type(Fire) == "function" then
        local GetFunc = getupvalue(Invoke, 1)
        local GetEvent = getupvalue(Fire, 1)
    else
        print("Invoke or Fire is not a function, skipping getupvalue.")
    end
end)

coroutine.wrap(function()
    setidentity(2)
    -- Pastikan Invoke adalah fungsi sebelum menggunakan getupvalue
    if type(Invoke) == "function" then
        hookfunc(getupvalue(Invoke, 1), function()
            return true
        end)
    else
        print("Invoke is not a function in coroutine.")
    end
    setidentity(8)
end)()

coroutine.wrap(function()
    setidentity(2)
    -- Pastikan Fire adalah fungsi sebelum menggunakan getupvalue
    if type(Fire) == "function" then
        hookfunc(getupvalue(Fire, 1), function()
            return true
        end)
    else
        print("Fire is not a function in coroutine.")
    end
    setidentity(8)
end)()

-- Sisa kode tetap sama
